{% extends 'admin/layout.html.twig' %}

{% block title %}V&G : liste des commandes{% endblock %}

{% block body %}
    <h1 class="mb-4">
        <i class="bi bi-people-fill"></i>Commandes
    </h1>

    <!--
    <a href="{{ path('admin_commande_edit', {id: 0}) }}" class="btn btn-primary mb-3">
        <i class="bi bi-plus-circle"></i>&nbsp;Ajouter une commande
    </a>
    -->

    <div class="table-responsive">
        <table class="table table-striped" style="overflow-x: auto; overflow-y: visible; max-width: 100%; -webkit-overflow-scrolling: touch;">
            <thead>
            <tr>
                <th>Statut</th>
                <th>Numéro</th>
                <th>Client</th>
                <th>Menu</th>
                <th>Adresse</th>
                <th>Date commande</th>
                <th>Date livraison</th>
                <th>Remise</th>
                <th>Montant ttc</th>
                <th>Prêt matériel</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            {% if tabCommande|length > 0 %}
                {% for item in tabCommande %}
                    {% set lien_cmd = path('admin_commande_edit', {id: item.commande.id}) %}
                    <tr style="cursor: pointer">
                        <td style="width: 10%; background-color: {{ item.commande_etat.couleur ?? '' }}" onclick="goToUrl('{{ lien_cmd }}')">{{ item.commande_etat.libelle }}</td>
                        <td {{ item.class_danger }} onclick="goToUrl('{{ lien_cmd }}')">{{ item.commande.numero }}</td>
                        <td {{ item.class_danger }} onclick="goToUrl('{{ lien_cmd }}')">{{ item.utilisateur.nom ~ ' ' ~ item.utilisateur.prenom }}</td>
                        <td {{ item.class_danger }} onclick="goToUrl('{{ lien_cmd }}')">{{ item.menu.libelle }}</td>
                        <td {{ item.class_danger }} onclick="goToUrl('{{ lien_cmd }}')">{{ item.utilisateur.adresse ~ ' - ' ~ item.utilisateur.code_postal ~ ' - ' ~ item.utilisateur.commune }}</td>
                        <td {{ item.class_danger }} onclick="goToUrl('{{ lien_cmd }}')">{{ item.commande.created_at|date('d/m/Y à H:i') }}</td>
                        <td {{ item.class_danger }} onclick="goToUrl('{{ lien_cmd }}')">{{ item.commande.date|date('d/m/Y à H:i') }}</td>
                        <td {{ item.class_danger }} onclick="goToUrl('{{ lien_cmd }}')">{{ item.commande.remise }} %</td>
                        <td {{ item.class_danger }} onclick="goToUrl('{{ lien_cmd }}')">{{ item.commande.total_ttc }} €</td>
                        <td {{ item.class_danger }} onclick="goToUrl('{{ lien_cmd }}')">{% if item.commande.pret_materiel %}Oui{% else %}Non{% endif %}</td>
                        <td>
                            <div class="d-flex gap-1 flex-wrap">
                                <a href="{{ lien_cmd }}" class="btn btn-sm btn-warning" title="Voir la commande">
                                    <i class="bi bi-pencil-square"></i>
                                </a>
                                <a href="{{ path('admin_commande_delete', {id: item.commande.id}) }}" class="btn btn-sm btn-danger" title="Supprimer la commande" onclick="return confirm('Êtes-vous sûr de vouloir supprimer la commande ?')">
                                    <i class="bi bi-trash3-fill"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="10">
                        <div class="alert alert-warning text-center">Aucun résultat</div>
                    </td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    </div>
{% endblock %}
